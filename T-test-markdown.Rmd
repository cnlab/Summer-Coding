---
title: "Descriptive Statistics and T-tests"
author: "Steven"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: hide
    df_print: paged
    highlight: tango
    theme: united
    toc: yes
    toc_float:
      collapsed: yes
      smooth_scroll: yes
  word_document:
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE, message=FALSE}
# set chunk options for the document
# include=FALSE means that this chunk will not show up in the report

knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, cache = FALSE, dpi = 150, fig.path = "figs/") 
# echo = TRUE means that the source code will be displayed
# message = FALSE suppresses messages
# warning = FALSE suppresses warnings
# cache = FALSE recompiles from scratch each time you knit 
# dpi = 150 sets the figure resolution
# fig.path specifies a directory where figures will be output

options(digits = 4) 
set.seed(123) #set seed for random number generation
```

# Getting everything set up {.tabset}

## Set Working Directory and Load Packages

Change to your own working directory (WD) to save things like plots. You can do that buy modifying the file path or go session (on the upper bar) --> set working directory). Working directories are important in R because they tell the computer where to look to grab information and save things like results. This can vary by project, script, etc. so it's important to consistently have the appropriate WD. If you are unsure what your current WD is, you can use the `getwd` command in the console (usually the lower left hand pane) to get your WD. 

**include screenshot?**

One of the great things about R is its ability to be super flexible. This comes from R's ability to use different `packages`. You can load packages into your current `work place` by using the `library(PACKAGE)` function. It is important to note that in order to `library` a package you must first have it installed. To install a package you can use the `install.packages("PACKAGE")` command. You can learn more about the different types of packages hosted on the Comprehensive R Archive Network (CRAN) [here](https://cran.r-project.org/)! One other important thing is that some packages often have similar commands (e.g., `plyr` and `hmisc` both use summarize) that are masked. To get around this you can use `PACKAGE::FUNCTION` to call package-specfic function. 

For this script, and here forward, We use `pacman` to load in all of our packages rather than using the iterative `if (!require("PACKAGE")) install.packages("PACKAGE")` set-up. There's still some merit to using that if loading in packages creates issues like loading `tidyverse` and `brms` in a certain fashion. 

```{r}
setwd("/Users/stevenmesquiti/Desktop/Summer Coding Curriculum/Summer-Coding") #change to your own WD. you can do that buy modifying the file path or go session (on the upper bar) --> set working directory)
if (!require("pacman")) install.packages("pacman") #run this if you don't have pacman 
library(pacman)
pacman::p_load(tidyverse, ggpubr, rstatix, caret, broom, kableExtra, reactable, Hmisc, datarium, car, install = T) 
#use pacman to load packages quickly 
```

## Get our plot aesthetics set-up

This is a super quick and easy way to style our plots without introduce a vile amount of code lines to each chunk! 

```{r, include=FALSE}
palette_map = c("#3B9AB2", "#EBCC2A", "#F21A00")
palette_condition = c("#ee9b00", "#bb3e03", "#005f73")

plot_aes = theme_classic() + # 
  theme(legend.position = "top",
        legend.text = element_text(size = 12),
        text = element_text(size = 16, family = "Futura Medium"),
        axis.text = element_text(color = "black"),
        axis.line = element_line(colour = "black"),
        axis.ticks.y = element_blank())
```

## Build Relevant Functions

Using stuff like summary functions allows for us to present results in a clean, organized manner. For example, we can trim superfluous information from model output when sharing with collaborators among other things.

```{r}
mystats <- function(x, na.omit=FALSE){
  if (na.omit)
    x <- x[!is.na(x)]
  m <- mean(x)
  n <- length(x)
  s <- sd(x)
  skew <- sum((x-m)^3/s^3)/n
  kurt <- sum((x-m)^4/s^4)/n - 3
  return(c(n=n, mean=m, stdev=s, skew=skew, kurtosis=kurt))
}

```

## Load data 

Since we are using an existing dataset in R, we don't need to do anything fancy here. However, when normally load in data you can use a few different approaches. In most reproducible scripts you'll see people use nomenclature similar to `df`, `data`, `dataframe`, etc. to denote a dataframe. If you are working with multiple datasets, it's advisable to call stuff by a intuitive name that allows you to know what the data actually is. For example, if I am working with two different corpora (e.g., Atlantic and NYT Best-Sellers) I will probably call the Atlantic dataframe `atlantic` and the NYT Best-sellers `NYT` for simplicity and so I don't accidentally write over files. 

For example, if your WD is already set you can use: `df <- read_csv(MY_CSV.csv)`

If the data is on something like `Github` you can use: `df <- read_csv('https://raw.githubusercontent.com/scm1210/Language_Lab_Repro/main/Atlantic_Cleaned_all_vars.csv') #read in the data`. 

If you are working in one directory and need to call something for another folder you can do something like: `Atlantic_FK <- read_csv("~/Desktop/working-with-lyle/Atlantic/Atlantic_flesch_kinkaid_scores.csv")`

There are also other packages/functions that allow you to read in files with different extensions such as `haven::read_sav()` to read in a file from SPSS or `rjson:: fromJSON(file="data.json")`to read in a json file. If you want to learn more about how to reading in different files you can take a peek at [this site](https://www.datafiles.samhsa.gov/get-help/format-specific-issues/how-do-i-read-data-r). 

```{r}
# Load the data
data("genderweight", package = "datarium")
genderweight <- as.data.frame(genderweight)

# Show a sample of the data by group
```

# Brief Description {.tabset}

Now that we got everything set up, we are going to get into our analyses. Today we are going to be looking at gender differences between males and females in weight using the `genderweight` dataset from the `Datarium` package in R! To this quantify this, we'll use an **Independent T-test**. An Independent T-test is when we have one IV with **only** two levels (e.g., gender: Male and Female) and one DV that is continuous (e.g., weight ranging from 0 to idk 250). If the IV has more than two levels we need to use another type of test called ANOVA; more on that later :). 

Some other things:
• Two means calculated from two samples
• Null hypothesis: Means from two samples are similar
• Alternative hypothesis: Means from two samples are different
• The bigger the observed difference between sample means = More likely sample means differ (capture this with effect size). 

## Assumptions

Assumption are also important. That is, data need to possess certain qualities for us to be able to use this type of test. For a t-test these are: 
• The DV data are continuous (not ordinal or nominal).
• The sample data have been randomly sampled from a population.
• There is homogeneity of variance (i.e., the variability of the data in each group is similar).
• The distribution is approximately normal.

## Continuous 

We can check this by looking at the structutre of our data using the `class` function (for one variable) or `str` function (for all the variables in our dataset). We can see that weight is `numeric` and therefore continuous!

```{r}
class(genderweight$weight)
```

```{r}
str(genderweight)
```

## Randomly Sampled 

This is something you do when you design the study--we can't do anything in R to check this.

## Homogeneity of Variance 

We need to make sure the variability of the data in each group is similar. We can use something called Levene's Test for equality of error variances to do this. If we violate this assumption (p <. 05 in our test) we will have to use a Welch's T-test. We violate this assumption so if we were actually doing a meaningful project we would need to use a different statistical test. For the sake of brevity we'll pretend we are ok for now. 

```{r}
leveneTest(genderweight$weight ~ genderweight$group)
```

## The distribution is approximately normal.

To check the distribution of the data we can use density plots in the `ggplot` within `tidyverse` to visualize this. It's also important to get some statistics behind this, and to do that we can look at skewness and kurtosis via the `mystats` function that we wrote earlier. You can also use `psych::describe` to get similar information. For skewness and kurtosis, we want values of skewness fall between − 3 and + 3, and kurtosis is appropriate from a range of − 10 to + 10 

```{r}
# Basic density
p <- ggplot(genderweight, aes(x=weight)) + 
  geom_density(color="dodgerblue4", fill="dodgerblue3", alpha=0.2) + plot_aes
# Add mean line
p+ geom_vline(aes(xintercept=mean(weight)),
            color="dodgerblue3", linetype="dashed", size=1) + labs(caption = "Vertical line represents mean value")
```

We can also have the densities by gender. Looks like we should have some interesting results!

```{r}
p<-ggplot(genderweight, aes(x=weight, color=group, fill=group,alpha=0.2)) +
  geom_density()+geom_vline(aes(xintercept=mean(weight)),
            color="blue", linetype="dashed", size=1) + plot_aes + labs(caption = "Vertical line represents mean value")
p  
```


```{r}
mystats(genderweight$weight)
```

# Summarty Statistics {.tabset}

It's also important for us to get some summary statistics for our data (e.g., N's, Means, SDs).

## Sample Size, Means, and Standard Deviations 
```{r}
genderweight %>%
  group_by(group) %>%
  get_summary_stats(weight, type = "mean_sd") %>% 
  reactable::reactable(striped = TRUE)
```

## Build a simple graph to visualize 

We also visualize our data with a box plot, while overlaying the scatterplots!

```{r}
 # Create a box plot with jittered data points
ggplot(genderweight, aes(x = group, y = weight,color = group)) +
  geom_boxplot() +
  geom_jitter(width = 0.2, size = 2,alpha=0.2) +
  # Add axis labels
  xlab("Groups") +
  ylab("Weight") +
  plot_aes +
  # Add plot title
  ggtitle("Weight by Groups") + theme(plot.title = element_text(hjust = 0.5))
```

# Main Analyses {.tabset}

Now, we'll conduct our independent t-test to see if there are gender differences in weight, as well as getting the proportion of variance accounted for/Magnitude of the effect (Cohen's D).

## Independent T-test

From inspecting our output, we can see that we have a significant effect of gender on weight. That is, when conducting an independent t-test we observed a large effect, sucha that that Men (M = 85.826, SD = 4.354) possessed significantly greater [*t*(26.87) =-20.79, *p* < .001, d = -6.575] body weight compared to their female counterparts (M = 63.499, SD = 2.028). 

```{r}
stat.test <- genderweight %>% 
  t_test(weight ~ group) %>%
  add_significance()
stat.test
```

## Cohen's D

From inspecting our output, we can see we have a large effect of gender 

```{r}
genderweight %>%  cohens_d(weight ~ group, var.equal = TRUE)
```
## Visualize our results using GG-Plot with stats

```{r}
plot <- ggplot(genderweight, aes(x = group, y = weight, color = group)) +
  geom_boxplot() +
  geom_jitter(width = 0.2, size = 2) +
  # Add axis labels
  xlab("Gender") +
  ylab("Weight") +
  plot_aes +
  # Add plot title
  ggtitle("Weight by Gender") + theme(plot.title = element_text(hjust = 0.5))

stat.test <- stat.test %>% add_xy_position(x = "group")
plot +  stat_pvalue_manual(stat.test, tip.length = 0) +
  labs(subtitle = get_test_label(stat.test, detailed = TRUE))

```

# Package Citations 
```{r}
report::cite_packages()
```

All credit goes to the great Dani Cosme for teaching me how to make these! You can find her [github](https://github.com/dcosme) here!

